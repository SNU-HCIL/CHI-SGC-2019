<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <style>
            body {
                background-color: white;
            }
        </style>
        <title>Pacman</title>
    </head>
    <body>
        <div id="board"></div>
        <div id="notice"></div>
        <script src="game.js"></script>
        <script>
            let boardDiv = document.getElementById("board");
            let noticeDiv = document.getElementById("notice");
            
            /*
             [Object id]
                    -3: `Ghost`(enemy)
                    -2: `Pacman`(player)
                    -1: wall(obstacle)
                     0: empty
             1 or more: `Food` (ID value means the size of `Food`)
                               (ID of `food` is 1)
            */
            let initialState = [
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1,  5,  1,  1,  1, -1,  1,  1,  1,  1,  1,  1,  1,  1, -1,  1,  1,  1,  1, -1],
                [-1,  1, -1, -1,  1, -1,  1, -1, -1, -1, -1, -1, -1,  1, -1,  1, -1, -1,  1, -1],
                [-1,  1, -1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, -1,  1, -1],
                [-1,  1, -1,  1, -1, -1,  1, -1, -1,  0,  0, -1, -1,  1, -1, -1,  1, -1,  1, -1],
                [-1,  1,  1,  1,  1,  1,  1, -1, -3,  0,  0, -3, -1,  1,  1,  1,  1,  1,  1, -1],
                [-1,  1, -1,  1, -1, -1,  1, -1, -1, -1, -1, -1, -1,  1, -1, -1,  1, -1,  1, -1],
                [-1,  1, -1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, -2,  1,  1,  1, -1,  1, -1],
                [-1,  1, -1, -1,  1, -1,  1, -1, -1, -1, -1, -1, -1,  1, -1,  1, -1, -1,  1, -1],
                [-1,  1,  1,  1,  1, -1,  1,  1,  1,  1,  1,  1,  1,  1, -1,  1,  1,  1,  5, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1]
            ];
            let game = new Game(initialState, boardDiv, noticeDiv);

            let result;
            let totalReward = 0;
            let html = `
                <h2>Reward: ` + totalReward + `, Done: ` + false + `</h2>
                <h3>Possible actions:`;
            for (let action of game.possible_actions) {
                html += ' ' + action;
            }
            html += `</h3>`
            noticeDiv.insertAdjacentHTML('beforeend', html);

            document.addEventListener('keydown', (event) => {
                if (event.keyCode === 37) {
                    result = game.step("left");
                }
                else if (event.keyCode === 38) {
                    result = game.step("up");
                }
                else if (event.keyCode === 39) {
                    result = game.step("right");
                }
                else if (event.keyCode === 40) {
                    result = game.step("down");
                }
                if (result != null) {
                    while (noticeDiv.hasChildNodes()) {
                        noticeDiv.removeChild(noticeDiv.firstChild);
                    }
                    totalReward += result.reward;
                    let html = `
                        <h2>Reward: ` + totalReward + `, Done: ` + result.done + `</h2>
                        <h3>Possible actions:`;
                    for (let action of game.possible_actions) {
                        html += ' ' + action;
                    }
                    html += `</h3>`
                    noticeDiv.insertAdjacentHTML('beforeend', html);
                }
            }, true);
        </script>
    </body>
</html>